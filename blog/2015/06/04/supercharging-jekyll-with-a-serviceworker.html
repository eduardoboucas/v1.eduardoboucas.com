<!DOCTYPE html>
<html>
<head>
    



<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Eduardo Boucas - Web Developer from London</title>
<meta name="description" content="A passionate and creative full-stack web developer that thinks code and numbers, but breathes art and design. Responsible and responsive. Terrible dancer.">
<link rel="alternate" type="application/rss+xml" title="Eduardo saying things" href="http://feeds.eduardoboucas.com/eduardoboucas" />
<link href="/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<link rel="shortcut icon" href="/assets/images/favicon.ico" type="image/x-icon" />

<!-- Open graph -->
<meta content="Eduardo Boucas - Web Developer from London" property="og:site_name">
<meta content="Eduardo Boucas - Web Developer from London" property="og:title">
<meta content="https://eduardoboucas.com/assets/images/bust.png" property="og:image">
<meta content="website" property="og:type">
<meta content="A passionate and creative full-stack web developer that thinks code and numbers, but breathes art and design. Responsible and responsive. Terrible dancer." property="og:description">
<meta content="https://eduardoboucas.com" property="og:url">

<!-- Facebook stuff -->


<!-- Twitter Card -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@eduardoboucas" />
<meta name="twitter:image" content="https://eduardoboucas.com/assets/images/bust.png" />
<meta name="twitter:title" content="Eduardo Boucas - Web Developer from London" />
<meta name="twitter:description" content="A passionate and creative full-stack web developer that thinks code and numbers, but breathes art and design. Responsible and responsive. Terrible dancer." />
<meta name="twitter:url" content="https://eduardoboucas.com" />
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://eduardoboucas.com/blog">

    

    

    <script src="/js/vendor/jquery.min.js"></script>
<script src="/js/blog.js"></script>
<script src="/js/vendor/spinner.min.js"></script>
<script src="/js/vendor/jekyll-search.js"></script>
</head>

<body class="body--blog">
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
	<symbol id="icn--arrow" viewBox="0 0 45 60">
		<title>Arrow</title>
		<path d="M43.8,28H16c0.1-0.4,0.2-0.7,0.3-1.2c0.6-2,1.3-4.5,2.8-7.6c0,0,0,0,0,0c0,0,0,0,0,0c0.1-0.2,0-0.5-0.2-0.7
		c-0.2-0.1-0.5,0-0.7,0.2c-4,7.9-17.5,10.7-17.7,10.7c-0.2,0-0.4,0.3-0.4,0.5s0.2,0.4,0.4,0.5c0.1,0,13.6,2.9,17.6,10.7c0,0,0,0,0,0
		c0,0,0,0,0,0l0,0c0,0,0.1,0.1,0.1,0.1c0.1,0.1,0.2,0.2,0.4,0.2c0.3,0,0.5-0.2,0.5-0.5c0-0.1,0-0.2-0.1-0.3c-1.7-3.3-2.5-6-3-7.9
		C16,32.5,16,32.2,15.9,32h27.8c0.5,0,1-0.5,1-1v-2C44.8,28.5,44.3,28,43.8,28z"/>
	</symbol>

	<symbol id="icn--chair" viewBox="0 0 45 60">
		<title>Chair</title>
		<path d="M40.8,0.3C40.6,0.1,40.4,0,40.1,0c-0.6,0-1.7,0.3-2.4,0.7c-0.7,0.4-1.6,0.6-1.9,0.7c-0.4,0-2.1-0.3-4-0.7
		c-1-0.2-2.3-0.3-3.8-0.3c-1.3,0-2.5,0.1-3.5,0.3l-0.2,0c-2.2,0.4-4.2,0.7-4.7,0.7c-0.5,0-1.2-0.2-1.5-0.5c-0.5-0.4-1.5-0.7-2.1-0.7
		c-0.3,0-0.6,0.1-0.8,0.4c-0.4,0.5-0.5,1.3-0.2,2.2c0.2,0.8,1.1,1.6,2.3,2c0,0,0,0.1,0,0.1c0,0.6,0.1,1.6,0.2,2.7
		c0.2,2.2,0.5,5.2,0.9,8.1c0.4,2.9,0.9,5.8,1.4,8c0.2,0.8,0.3,1.5,0.4,2.1l-1.8-0.1L8.2,26.2c-0.5,0-0.9,0.4-0.9,0.9
		c0,0.5,0.4,0.9,0.9,0.9l2.4,0.1c-0.2,0.8-0.6,1.9-0.9,3.2C8.9,34.2,7.9,38,7,41.9c-0.9,3.8-1.7,7.7-2.3,10.6
		c-0.3,1.4-0.5,2.7-0.6,3.5c-0.1,0.9-0.2,1.3-0.2,1.3c0,0.2,0.1,0.4,0.3,0.5c0.2,0.1,0.5-0.1,0.5-0.3c0,0,0.1-0.5,0.4-1.3
		c0.2-0.8,0.6-2,1-3.4c0.3-1.2,0.7-2.6,1.1-4.1c0.2,0,0.3,0,0.5,0c0.9-0.1,2.1-0.2,3.3-0.3c0.4-0.1,0.8-0.1,1.2-0.2
		c0.4,0.1,1,0.1,1.7,0.2c0.3,0,0.6,0.1,0.9,0.1c0,0.4,0,0.8,0,1.1c0,1.3-0.1,2.3-0.1,3.1c0,0.7,0,1.2,0,1.2c0,0.2,0.1,0.4,0.4,0.4
		c0.2,0,0.4-0.1,0.5-0.3c0,0,0.1-0.4,0.2-1.2c0.1-0.7,0.3-1.8,0.5-3c0-0.3,0.1-0.7,0.1-1.1c1.1,0.1,2.2,0.2,3.4,0.3
		c1.1,0.1,2.1,0.1,3.1,0.2c0,0,0,0,0,0c0,0,0,0.1,0,0.1c0.1,1.9,0.3,3.8,0.4,5.3c0.1,1.6,0.2,2.8,0.3,3.8c0.1,0.9,0.1,1.4,0.1,1.4
		c0,0.2,0.2,0.4,0.4,0.4c0.2,0,0.4-0.2,0.4-0.4c0,0,0-0.5,0-1.4c0-0.9,0.1-2.2,0.1-3.8c0-1.3,0-2.7,0-4.3c0.1,0,0.2,0,0.3-0.1
		c0.8-0.1,1.9-0.3,3-0.6c1.1-0.3,2.2-0.6,3-0.8c0.2-0.1,0.3-0.1,0.5-0.2c0.2,1.1,0.5,2.1,0.7,3c0.3,1.4,0.6,2.5,0.8,3.3
		c0.2,0.8,0.3,1.2,0.3,1.2c0.1,0.2,0.2,0.3,0.5,0.3c0.2,0,0.4-0.2,0.4-0.5c0,0-0.1-0.5-0.1-1.3c-0.1-0.8-0.2-2-0.4-3.4
		c-0.4-2.8-1-6.4-1.7-10.1c-0.7-3.7-1.5-7.3-2.1-10c-0.2-1-0.5-1.9-0.7-2.6l3.2-0.3c0.5-0.1,0.9-0.5,0.8-1c0-0.5-0.4-0.9-0.9-0.9
		l-1.5-0.1c0.3-0.6,0.7-1.5,1.2-2.5c0.9-2.1,2.2-5,3.3-7.9c1.1-2.9,2.1-5.8,2.8-8.1C38.6,6.6,38.8,5.7,39,5c0-0.2,0.1-0.3,0.1-0.5
		c0.9-0.5,1.6-1.1,1.8-1.8C41.2,1.7,41.1,0.8,40.8,0.3z M28.3,26.1l-0.6,0c0.1-0.4,0.2-0.9,0.2-1.4c0.1-1.8,0.7-4.6,1.3-6.4
		c0.6-1.8,0.9-5.4,0.6-8c-0.2-1.8-0.3-3.8-0.2-5.1h4c-0.2,0.6-0.5,1.5-0.8,2.6c-0.6,2.1-1.5,5-2.2,7.8c-0.4,1.4-0.7,2.9-1,4.2
		c-0.3,1.3-0.6,2.6-0.8,3.7C28.6,24.6,28.4,25.5,28.3,26.1z M23.4,25.9c0-0.6,0-1.3,0-2.1c0-1,0-2.3,0-3.6c0-1.3-0.1-2.7-0.1-4.1
		c-0.1-2.8-0.3-5.6-0.4-7.7c-0.1-1.6-0.3-2.7-0.3-3.2h3.7C26,6.4,25.5,8,25,9.6c-0.8,2.5-1.2,6.4-0.9,8.8c0.3,2.2,0.3,5.2,0.1,6.6
		c-0.1,0.4-0.1,0.7-0.1,1L23.4,25.9z M21.1,23.5c-0.2-2.2-0.5-5.2-0.9-8.1c-0.4-2.9-0.9-5.9-1.3-8c-0.2-0.9-0.4-1.7-0.5-2.3
		c0.4,0.1,0.8,0.1,1.3,0.1h2.3c0,0.5-0.1,1.7-0.1,3.3c0,2.1,0,4.9,0.1,7.7c0.1,1.4,0.1,2.8,0.2,4.1c0.1,1.3,0.2,2.5,0.3,3.6
		c0.1,0.8,0.1,1.5,0.2,2.1l-1.3,0C21.3,25.2,21.2,24.4,21.1,23.5z M10.9,47.4c-1.2,0.2-2.4,0.4-3.3,0.6c-0.1,0-0.2,0-0.2,0
		c0.5-1.8,1-3.8,1.4-5.7c0.9-3.8,1.7-7.7,2.3-10.6c0.3-1.4,0.5-2.6,0.6-3.4l5.1,0.2c-0.1,0.7-0.2,1.5-0.4,2.4c-0.4,2.5-0.7,5.9-1,9.3
		c-0.2,2.4-0.4,4.7-0.5,6.8c-0.2,0-0.5,0-0.8,0C13.3,47.1,12.1,47.2,10.9,47.4z M14.8,47.7c0,0,0.1,0,0.1,0c0,0,0,0,0,0
		C14.9,47.7,14.8,47.7,14.8,47.7z M19.9,47.9c-1.2-0.1-2.3-0.1-3.4-0.2c0.3-2.2,0.6-4.8,0.8-7.3c0.3-3.4,0.5-6.8,0.6-9.3
		c0-1,0-1.8,0-2.5l4.6,0.2c0,0.8,0,1.7,0,2.8c0,1.6,0,3.4,0,5.3c0,1.9,0.1,4,0.2,6.1c0.1,1.7,0.1,3.4,0.2,5.1
		C22,48,20.9,48,19.9,47.9z M24.9,49.4c-0.1,0-0.1,0-0.2,0.1c0-0.1,0-0.2,0-0.4c0.3,0,0.7,0,1,0c0.1,0,0.1,0,0.1,0
		C25.5,49.2,25.2,49.3,24.9,49.4z M28.4,31.4c0.4,2.8,1,6.4,1.7,10.1c0.4,2.2,0.9,4.4,1.3,6.4c-0.2,0-0.3,0-0.5,0.1
		c-0.8,0.1-1.9,0.3-3,0.6c-0.1,0-0.1,0-0.2,0.1c-0.5-0.1-1.1-0.1-1.9-0.2c-0.3,0-0.7-0.1-1-0.1c0-1.7-0.1-3.5-0.1-5.3
		c-0.1-2.1-0.2-4.2-0.3-6.1c-0.1-1.9-0.3-3.8-0.4-5.3c-0.1-1-0.2-1.9-0.2-2.7l1,0c0,0,0,0,0,0c0,0,0.1,0,0.1,0l3.2-0.3
		C28.2,29.3,28.3,30.3,28.4,31.4z M36.8,7.2c-1,2.1-2.1,5-3.2,7.9c-1.1,2.9-2.1,5.8-2.8,8.1c-0.4,1.1-0.6,2-0.8,2.7
		c0,0.1-0.1,0.2-0.1,0.3l-0.7,0c0.2-0.6,0.4-1.4,0.7-2.3c0.3-1.1,0.7-2.3,1.1-3.6c0.4-1.3,0.7-2.8,1.1-4.2c0.8-2.9,1.4-5.7,1.9-7.9
		c0.3-1.2,0.5-2.3,0.6-2.9h1.7c0.6,0,1.1-0.1,1.7-0.2C37.6,5.6,37.2,6.3,36.8,7.2z"/>
	</symbol>

	<symbol id="icn--external" viewBox="0 0 768 1024">
		<title>External link</title>
		<path d="M640 768h-512v-510.094l128-1.906v-128h-256v768h768v-320h-128v192zM384 128l128 128-192 192 128 128 192-192 128 128v-384h-384z"></path>
	</symbol>

	<symbol id="icn--search" viewBox="0 0 1024 1024">
		<path d="M992.262 871.396l-242.552-206.294c-25.074-22.566-51.89-32.926-73.552-31.926 57.256-67.068 91.842-154.078 91.842-249.176 0-212.078-171.922-384-384-384-212.076 0-384 171.922-384 384s171.922 384 384 384c95.098 0 182.108-34.586 249.176-91.844-1 21.662 9.36 48.478 31.926 73.552l206.294 242.552c35.322 39.246 93.022 42.554 128.22 7.356s31.892-92.898-7.354-128.22zM384 640c-141.384 0-256-114.616-256-256s114.616-256 256-256 256 114.616 256 256-114.614 256-256 256z"></path>
	</symbol>

	<symbol id="icn--cross" viewBox="0 0 1024 1024">
		<path class="path1" d="M512 0c-282.77 0-512 229.23-512 512s229.23 512 512 512 512-229.23 512-512-229.23-512-512-512zM512 928c-229.75 0-416-186.25-416-416s186.25-416 416-416 416 186.25 416 416-186.25 416-416 416z"></path>
		<path class="path2" d="M672 256l-160 160-160-160-96 96 160 160-160 160 96 96 160-160 160 160 96-96-160-160 160-160z"></path>
	</symbol>

	<symbol id="icn--codepen" viewBox="0 0 120 120">
		<path class="outer-ring" d="M60.048 0C26.884 0 0 26.9 0 60.048s26.884 60 60 60.047c33.163 0 60.047-26.883 60.047-60.047 S93.211 0 60 0z M60.048 110.233c-27.673 0-50.186-22.514-50.186-50.186S32.375 9.9 60 9.9 c27.672 0 50.2 22.5 50.2 50.186S87.72 110.2 60 110.233z"/>
		<path class="inner-box" d="M97.147 48.319c-0.007-0.047-0.019-0.092-0.026-0.139c-0.016-0.09-0.032-0.18-0.056-0.268 c-0.014-0.053-0.033-0.104-0.05-0.154c-0.025-0.078-0.051-0.156-0.082-0.232c-0.021-0.053-0.047-0.105-0.071-0.156 c-0.033-0.072-0.068-0.143-0.108-0.211c-0.029-0.051-0.061-0.1-0.091-0.148c-0.043-0.066-0.087-0.131-0.135-0.193 c-0.035-0.047-0.072-0.094-0.109-0.139c-0.051-0.059-0.104-0.117-0.159-0.172c-0.042-0.043-0.083-0.086-0.127-0.125 c-0.059-0.053-0.119-0.104-0.181-0.152c-0.048-0.037-0.095-0.074-0.145-0.109c-0.019-0.012-0.035-0.027-0.053-0.039L61.817 23.5 c-1.072-0.715-2.468-0.715-3.54 0L24.34 46.081c-0.018 0.012-0.034 0.027-0.053 0.039c-0.05 0.035-0.097 0.072-0.144 0.1 c-0.062 0.049-0.123 0.1-0.181 0.152c-0.045 0.039-0.086 0.082-0.128 0.125c-0.056 0.055-0.108 0.113-0.158 0.2 c-0.038 0.045-0.075 0.092-0.11 0.139c-0.047 0.062-0.092 0.127-0.134 0.193c-0.032 0.049-0.062 0.098-0.092 0.1 c-0.039 0.068-0.074 0.139-0.108 0.211c-0.024 0.051-0.05 0.104-0.071 0.156c-0.031 0.076-0.057 0.154-0.082 0.2 c-0.017 0.051-0.035 0.102-0.05 0.154c-0.023 0.088-0.039 0.178-0.056 0.268c-0.008 0.047-0.02 0.092-0.025 0.1 c-0.019 0.137-0.029 0.275-0.029 0.416V71.36c0 0.1 0 0.3 0 0.418c0.006 0 0 0.1 0 0.1 c0.017 0.1 0 0.2 0.1 0.268c0.015 0.1 0 0.1 0.1 0.154c0.025 0.1 0.1 0.2 0.1 0.2 c0.021 0.1 0 0.1 0.1 0.154c0.034 0.1 0.1 0.1 0.1 0.213c0.029 0 0.1 0.1 0.1 0.1 c0.042 0.1 0.1 0.1 0.1 0.193c0.035 0 0.1 0.1 0.1 0.139c0.05 0.1 0.1 0.1 0.2 0.2 c0.042 0 0.1 0.1 0.1 0.125c0.058 0.1 0.1 0.1 0.2 0.152c0.047 0 0.1 0.1 0.1 0.1 c0.019 0 0 0 0.1 0.039L58.277 96.64c0.536 0.4 1.2 0.5 1.8 0.537c0.616 0 1.233-0.18 1.77-0.537 l33.938-22.625c0.018-0.012 0.034-0.027 0.053-0.039c0.05-0.035 0.097-0.072 0.145-0.109c0.062-0.049 0.122-0.1 0.181-0.152 c0.044-0.039 0.085-0.082 0.127-0.125c0.056-0.055 0.108-0.113 0.159-0.172c0.037-0.045 0.074-0.09 0.109-0.139 c0.048-0.062 0.092-0.127 0.135-0.193c0.03-0.049 0.062-0.098 0.091-0.146c0.04-0.07 0.075-0.141 0.108-0.213 c0.024-0.051 0.05-0.102 0.071-0.154c0.031-0.078 0.057-0.156 0.082-0.234c0.017-0.051 0.036-0.102 0.05-0.154 c0.023-0.088 0.04-0.178 0.056-0.268c0.008-0.045 0.02-0.092 0.026-0.137c0.018-0.139 0.028-0.277 0.028-0.418V48.735 C97.176 48.6 97.2 48.5 97.1 48.319z M63.238 32.073l25.001 16.666L77.072 56.21l-13.834-9.254V32.073z M56.856 32.1 v14.883L43.023 56.21l-11.168-7.471L56.856 32.073z M29.301 54.708l7.983 5.34l-7.983 5.34V54.708z M56.856 88.022L31.855 71.4 l11.168-7.469l13.833 9.252V88.022z M60.048 67.597l-11.286-7.549l11.286-7.549l11.285 7.549L60.048 67.597z M63.238 88.022V73.14 l13.834-9.252l11.167 7.469L63.238 88.022z M90.794 65.388l-7.982-5.34l7.982-5.34V65.388z"/>
	</symbol>

	<symbol id="icn--facebook" viewBox="0 0 100 100">
		<path class="inner-shape" style="opacity: 1; fill: rgb(0, 0, 0);" transform="translate(5,5) scale(0.9)" d="M82.667,1H17.335C8.351,1,1,8.351,1,17.336v65.329c0,8.99,7.351,16.335,16.334,16.335h65.332 C91.652,99.001,99,91.655,99,82.665V17.337C99,8.353,91.652,1.001,82.667,1L82.667,1z M84.318,50H68.375v42.875H50V50h-8.855V35.973 H50v-9.11c0-12.378,5.339-19.739,19.894-19.739h16.772V22.3H72.967c-4.066-0.007-4.57,2.12-4.57,6.078l-0.023,7.594H86.75 l-2.431,14.027V50z"></path>
	</symbol>

	<symbol id="icn--github" viewBox="0 0 100 100">
		<path class="inner-shape" style="opacity: 1; fill: rgb(0, 0, 0);" transform="translate(5,5) scale(0.9)" d="M50,1C22.938,1,1,22.938,1,50s21.938,49,49,49s49-21.938,49-49S77.062,1,50,1z M79.099,79.099 c-3.782,3.782-8.184,6.75-13.083,8.823c-1.245,0.526-2.509,0.989-3.79,1.387v-7.344c0-3.86-1.324-6.699-3.972-8.517 c1.659-0.16,3.182-0.383,4.57-0.67c1.388-0.287,2.855-0.702,4.402-1.245c1.547-0.543,2.935-1.189,4.163-1.938 c1.228-0.75,2.409-1.723,3.541-2.919s2.082-2.552,2.847-4.067s1.372-3.334,1.818-5.455c0.446-2.121,0.67-4.458,0.67-7.01 c0-4.945-1.611-9.155-4.833-12.633c1.467-3.828,1.308-7.991-0.478-12.489l-1.197-0.143c-0.829-0.096-2.321,0.255-4.474,1.053 c-2.153,0.798-4.57,2.105-7.249,3.924c-3.797-1.053-7.736-1.579-11.82-1.579c-4.115,0-8.039,0.526-11.772,1.579 c-1.69-1.149-3.294-2.097-4.809-2.847c-1.515-0.75-2.727-1.26-3.637-1.532c-0.909-0.271-1.754-0.439-2.536-0.503 c-0.782-0.064-1.284-0.079-1.507-0.048c-0.223,0.031-0.383,0.064-0.478,0.096c-1.787,4.53-1.946,8.694-0.478,12.489 c-3.222,3.477-4.833,7.688-4.833,12.633c0,2.552,0.223,4.889,0.67,7.01c0.447,2.121,1.053,3.94,1.818,5.455 c0.765,1.515,1.715,2.871,2.847,4.067s2.313,2.169,3.541,2.919c1.228,0.751,2.616,1.396,4.163,1.938 c1.547,0.543,3.014,0.957,4.402,1.245c1.388,0.287,2.911,0.511,4.57,0.67c-2.616,1.787-3.924,4.626-3.924,8.517v7.487 c-1.445-0.43-2.869-0.938-4.268-1.53c-4.899-2.073-9.301-5.041-13.083-8.823c-3.782-3.782-6.75-8.184-8.823-13.083 C9.934,60.948,8.847,55.56,8.847,50s1.087-10.948,3.231-16.016c2.073-4.899,5.041-9.301,8.823-13.083s8.184-6.75,13.083-8.823 C39.052,9.934,44.44,8.847,50,8.847s10.948,1.087,16.016,3.231c4.9,2.073,9.301,5.041,13.083,8.823 c3.782,3.782,6.75,8.184,8.823,13.083c2.143,5.069,3.23,10.457,3.23,16.016s-1.087,10.948-3.231,16.016 C85.848,70.915,82.88,75.317,79.099,79.099L79.099,79.099z"></path>	
	</symbol>

	<symbol id="icn--linkedin" viewBox="0 0 100 100">
		<path class="inner-shape" style="opacity: 1; fill: rgb(0, 0, 0);" transform="translate(5,5) scale(0.9)" d="M82.539,1H17.461C8.408,1,1,8.408,1,17.461v65.078C1,91.592,8.408,99,17.461,99h65.078C91.592,99,99,91.592,99,82.539 V17.461C99,8.408,91.592,1,82.539,1z M37.75,80.625H25.5V37.75h12.25V80.625z M31.625,31.625c-3.383,0-6.125-2.742-6.125-6.125 s2.742-6.125,6.125-6.125s6.125,2.742,6.125,6.125S35.008,31.625,31.625,31.625z M80.625,80.625h-12.25v-24.5 c0-3.383-2.742-6.125-6.125-6.125s-6.125,2.742-6.125,6.125v24.5h-12.25V37.75h12.25v7.606c2.526-3.47,6.389-7.606,10.719-7.606 c7.612,0,13.782,6.856,13.782,15.312L80.625,80.625L80.625,80.625z"></path>	
	</symbol>

	<symbol id="icn--tumblr" viewBox="0 0 100 100">
		<path class="inner-shape" style="opacity: 1; fill: rgb(0, 0, 0);" transform="translate(5,5) scale(0.9)" d="M82.671,1H17.336C8.351,1,1,8.351,1,17.336v65.329c0,8.99,7.351,16.335,16.335,16.335h65.335 C91.654,99.001,99,91.655,99,82.665V17.336C98.999,8.352,91.654,1.001,82.671,1L82.671,1z M71.028,79.925 c-2.886,1.358-5.506,2.315-7.848,2.865c-2.344,0.545-4.877,0.819-7.599,0.819c-3.092,0-4.917-0.388-7.291-1.166 c-2.375-0.784-4.402-1.902-6.077-3.337c-1.681-1.447-2.841-2.986-3.49-4.612c-0.65-1.628-0.972-3.99-0.972-7.082V43.698h-9.187 v-9.576c2.655-0.861,5.736-2.099,7.626-3.708c1.899-1.615,3.418-3.547,4.564-5.807c1.149-2.255,1.938-5.132,2.369-8.62h9.618v15.642 h15.635v12.071H52.739v17.34c0,3.924-0.051,6.185,0.366,7.297c0.413,1.106,1.447,2.255,2.574,2.919 c1.498,0.898,3.207,1.346,5.132,1.346c3.425,0,6.832-1.112,10.216-3.338v10.665V79.925z"></path>	
	</symbol>

	<symbol id="icn--twitter" viewBox="0 0 100 100">
		<path class="inner-shape" style="opacity: 1; fill: rgb(0, 0, 0);" transform="translate(5,5) scale(0.9)" d="M99.001,19.428c-3.606,1.608-7.48,2.695-11.547,3.184c4.15-2.503,7.338-6.466,8.841-11.189 c-3.885,2.318-8.187,4-12.768,4.908c-3.667-3.931-8.893-6.387-14.676-6.387c-11.104,0-20.107,9.054-20.107,20.223 c0,1.585,0.177,3.128,0.52,4.609c-16.71-0.845-31.525-8.895-41.442-21.131C6.092,16.633,5.1,20.107,5.1,23.813 c0,7.017,3.55,13.208,8.945,16.834c-3.296-0.104-6.397-1.014-9.106-2.529c-0.002,0.085-0.002,0.17-0.002,0.255 c0,9.799,6.931,17.972,16.129,19.831c-1.688,0.463-3.463,0.71-5.297,0.71c-1.296,0-2.555-0.127-3.783-0.363 c2.559,8.034,9.984,13.882,18.782,14.045c-6.881,5.424-15.551,8.657-24.971,8.657c-1.623,0-3.223-0.096-4.796-0.282 c8.898,5.738,19.467,9.087,30.82,9.087c36.982,0,57.206-30.817,57.206-57.543c0-0.877-0.02-1.748-0.059-2.617 C92.896,27.045,96.305,23.482,99.001,19.428z"></path>	
	</symbol>

	<symbol id="icn--rss" viewBox="0 0 512 512">
		<path d="M161.757,406.249c0,30.791-24.96,55.751-55.75,55.751c-30.79,0-55.751-24.96-55.751-55.751 s24.961-55.75,55.751-55.75C136.796,350.499,161.757,375.458,161.757,406.249z M50.256,190.424v82.593 C153.994,274.083,238.172,358.261,239.238,462h82.593C320.764,312.48,199.774,191.491,50.256,190.424z M50.256,132.602 c87.695,0.381,170.084,34.695,232.135,96.747c62.175,62.173,96.506,144.764,96.754,232.651h82.6 C461.228,234.858,277.333,50.794,50.256,50V132.602z"/>	
	</symbol>

	<symbol id="icn--tag" viewBox="0 0 512 512">
		<path d="M463.906,0H319.625c-26.453,0-63.398,15.303-82.102,34.007L14.028,257.502c-18.704,18.704-18.704,49.312,0,68.016 l172.455,172.453c18.704,18.705,49.311,18.705,68.015,0l223.495-223.494C496.697,255.772,512,218.826,512,192.375V48.094 C512,21.642,490.357,0,463.906,0z M400,160c-26.51,0-48-21.49-48-48s21.49-48,48-48s48,21.49,48,48S426.51,160,400,160z"/>
	</symbol>

	<symbol id="icn--link" viewBox="0 0 512 512">
		<path d="M156.226,199.679c7.541-7.54,15.902-13.757,24.794-18.659c49.556-27.318,113.117-12.788,144.97,35.518 l-38.547,38.547c-11.059-25.227-38.5-39.565-65.813-33.456c-10.282,2.3-20.054,7.427-28.039,15.413l-73.898,73.896 c-22.433,22.433-22.432,58.936,0.002,81.369c22.433,22.433,58.935,22.433,81.368,0l22.78-22.779 c20.71,8.217,42.938,11.508,64.862,9.863l-50.278,50.278c-43.105,43.105-112.991,43.105-156.096,0 c-43.105-43.104-43.106-112.991-0.001-156.096L156.226,199.679z M273.574,82.33l-50.278,50.278 c21.928-1.643,44.152,1.648,64.863,9.865l22.779-22.78c22.434-22.434,58.936-22.434,81.37,0c22.434,22.434,22.434,58.936,0,81.37 l-73.897,73.895c-22.501,22.501-59.061,22.311-81.368,0c-5.202-5.201-9.694-11.678-12.484-18.04l-38.546,38.546 c4.049,6.142,8.261,11.453,13.666,16.858c13.949,13.95,31.698,24.339,52.117,29.251c26.466,6.37,54.823,2.839,79.185-10.592 c8.892-4.903,17.254-11.119,24.794-18.659l73.896-73.895c43.105-43.105,43.105-112.991,0.001-156.097 C386.566,39.225,316.68,39.225,273.574,82.33z"/>
	</symbol>

	<symbol id="icn--time" viewBox="0 0 512 512">
		<path id="time-icon" d="M367,295.5H227.5V142h45v108.5H367V295.5z M256,95c-88.992,0-161,72.022-161,161 c0,88.992,72.023,161,161,161c88.992,0,161-72.023,161-161C417,167.007,344.977,95,256,95 M256,50c113.771,0,206,92.229,206,206 s-92.229,206-206,206S50,369.771,50,256S142.229,50,256,50z"/>
	</symbol>
</svg>
  <div class="content content--blog">
    <div class="search-overlay">
	<section class="search">
	<div class="search__inner">
			<svg  class="search__icon">
	<use xlink:href="#icn--search"></use>
</svg>
			<input type="text" id="search__field" class="search__field" autoFocus>
		</div>
		<div id="search__results" class="search__results">
		</div>
	</section>
	<button id="search__close" class="search__close">Close</button>
</div>
<header class="blog-header">
  <div class="blog-header__back-to-site">
  	<a class="blog__back-to-site" href="/">
		<svg  class="page-navigation__arrow">
	<use xlink:href="#icn--arrow"></use>
</svg>
		<svg  class="page-navigation__chair">
	<use xlink:href="#icn--chair"></use>
</svg>
    </a>
  </div>
  <h1 class="blog-header__title"><a href="/blog/">Eduardo saying things.</a></h1>
  <img alt="Drawing of Eduardo's bust" class="blog-header__bust" src="/assets/images/bust.png"/>
  <button id="blog-header__search" class="blog-header__search">
  	<svg  class="blog-header__search-icon">
	<use xlink:href="#icn--search"></use>
</svg>
  </button>
</header>
    <p class="cta blog__back-to-posts"><a class="arrow--left" href="/blog">Back to all posts</a></p>

    <article class="post">
      <header class="post__header">
        <h1 class="post__title">Supercharging Jekyll with a ServiceWorker</h1>
        <ul class="post__meta">
          <li class="post__date"><svg  class="post__icon">
	<use xlink:href="#icn--time"></use>
</svg> Jun 4, 2015</li>
          
          <li class="post__tags"><svg  class="post__icon">
	<use xlink:href="#icn--tag"></use>
</svg>  <em><a href="/blog/tags.html#tag-serviceworker">serviceworker</a></em> <em><a href="/blog/tags.html#tag-javascript">javascript</a></em> <em><a href="/blog/tags.html#tag-jekyll">jekyll</a></em> <em><a href="/blog/tags.html#tag-offline">offline</a></em> <em><a href="/blog/tags.html#tag-cache">cache</a></em></li>
          
          <li class="post__permalink"><svg  class="post__icon">
	<use xlink:href="#icn--link"></use>
</svg> <a href="/blog/2015/06/04/supercharging-jekyll-with-a-serviceworker.html">Permalink</a></li>
        </ul>
      </header>
      <div class="post__body">
        <p>I’ve been reading a lot about JavaScript ServiceWorkers and, of course, I was itching to try them. A ServiceWorker is like <a href="http://www.html5rocks.com/en/tutorials/workers/basics/">a regular Web Worker</a> on steroids: it’s still great for doing some heavy-lifting in the background without disrupting the main thread, but the really cool thing about it is that it can function as a reverse proxy capable of intercepting any request made from a page.<!--more--></p>

<h2 id="introduction-and-motivations">Introduction and motivations</h2>

<p>Cool, so what problem does this novelty thing solve for us? None by itself. However, being able to have JavaScript intercepting every request before it’s actually sent to the network is a very powerful thing.</p>

<p>From a performance point of view, it puts the developer in control of how local caching works — what files to cache, when to cache them, serve them and update them. Because it runs in the background, it can silently fetch and cache all the files for the <em>About me</em> and <em>Contact</em> sections of a website whilst the visitor is still scrolling about on the landing page. When they do visit those pages, they will be served instantly because the files are already on disk, there’s no need to wait for a trip to the server.</p>

<p>But we can take it a step further: if the files are cached locally, we can even serve them without an internet connection. For the files that are not cached, we can still intercept the request, anticipate that an error is about to happen and serve an alternative page instead. This can be used for anything from a nice and simple “sorry, you seem to be offline” error page to a whole offline experience for a site.</p>

<p>A ServiceWorker is a much more complex animal than what I’ll describing in this article. It can be used for things like push notifications or geofencing, but I’ll be focusing on using it to improve the performance of my site and to make it available offline.</p>

<p>To get started, I recommend watching a short video called <a href="https://www.youtube.com/watch?v=d5_6yHixpsQ">Supercharging page load</a> (from where I shamelessly stole the term <em>Supercharging</em> for this article) in which Jake Archibald explains some key points about the technology. Additionally, <a href="http://www.html5rocks.com/en/tutorials/service-worker/introduction/">Introduction to Service Worker</a> from HTML5 Rocks is a great read if you want to dig deeper into this stuff.</p>

<h2 id="getting-started">Getting started</h2>

<p>Because ServiceWorker puts the developer in charge of the caching process, the first thing you have to decide is what files get cached and when to cache them. Do you want to cache absolutely everything right from the start? Do you want to cache pages as the user visits them? Do you want to give the user the option to specifically select what pages to cache using a <em>Read offline</em> button? If you’re not sure, <a href="http://jakearchibald.com/2014/offline-cookbook/">The offline cookbook</a> is a great place to learn about different caching strategies.</p>

<p>Because my site is powered by Jekyll and consists of just static HTML files, it’s already pretty fast, so what got me really excited about ServiceWorker was the possibility of creating a full offline experience — yes, at the expense of making it even faster, ugh!</p>

<p>So the plan was to start caching files in the background as soon as the user accesses the site for the first time and the ServiceWorker is installed, making the content available offline for any future visit. But what files to cache? I can’t start abusing the user’s bandwidth and disk space and download the entire site, so I had to choose carefully what files were essential for a usable offline experience and what files could be dropped.</p>

<h2 id="deciding-what-to-cache">Deciding what to cache</h2>

<p>My site consists of two main parts: a single-page application built with Backbone.js that serves the “About me”, “Portfolio” and “Find me” sections (along with the weird video sequence thing), and a standalone blog section (at the “/blog” entry point). For the main part to work, I would need:</p>

<ul>
  <li>Style sheets;</li>
  <li>All the JavaScript skeleton associated with BackboneJS (jQuery, RequireJS, router, views, etc.);</li>
  <li>The three heavily-compressed .mp4 files required for the video sequence and the JavaScript module that controls them;</li>
  <li>The HTML files for each of the sections (<em>About me</em>, <em>Portfolio</em> and <em>Find me</em>) and a couple of images used in them;</li>
  <li>On the portfolio section, there’s a page for each project featured, accompanied by a thumbnail and a small video (&lt;1MB) demoing the interaction with a website. It didn’t seem right to cache all the video files as it’d mean downloading around 15MB in videos, so instead I’ve just cached the thumbnail and a screenshot that serves as the poster image for the video. If you’re offline, you’ll see the still image instead of the video — not a bad deal.</li>
</ul>

<p>The blog part was a bit trickier though, because unlike the main site, it’s updated frequently and the posts are expected to grow indefinitely, not to mention the media assets used in them. For now, I’ve decided that I would cache the HTML files for every post but not the assets used in them, given that my blog is very text-oriented and in the not so frequent cases where I do use images, they’re rarely crucial to the story. This is just a first strategy that will probably change in the future.</p>

<h2 id="some-caveats">Some caveats</h2>

<p>There are some important things to take in before getting your hands dirty with the actual development:</p>

<ul>
  <li><strong>The browser support is very limited</strong>: As of the time of writing this article, ServiceWorker itself is supported by Chrome 40+, Opera 28+ and Chrome Mobile 42. However, if you want to use the Cache API you’ll need to grab <a href="https://github.com/coonsta/cache-polyfill">a polyfill</a>, as it’s still not supported natively. This is as simple as getting a JavaScript and calling it from the ServiceWorker using <code class="highlighter-rouge">importScripts()</code>.</li>
  <li><strong>It only works on HTTPS</strong>: With great power comes great responsibility, right? Being able to hijack every request is some very serious business, so to avoid malicious use it only works on websites served through HTTPS. <code class="highlighter-rouge">localhost</code> is an exception, so you’ll still be able to test everything locally.</li>
  <li><strong>It uses Promises</strong>: ServiceWorker relies heavily on the use of <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">JavaScript Promises</a>. Make sure you get comfortable with them before moving on.</li>
</ul>

<h2 id="implementation">Implementation</h2>

<p>Right, let’s get to the implementation then. The first step is to register a ServiceWorker (providing the browser supports it). Because users can get to my site either via the main web app or through the blog, I need to be able to register the ServiceWorker in both <code class="highlighter-rouge">index.html</code> and <code class="highlighter-rouge">blog/index.html</code>. Instead of creating a separate JavaScript file for this and require an additional HTTP request, I created a partial (<code class="highlighter-rouge">serviceWorker.html</code>) that I include when needed, so the JS code is automatically embedded on the pages.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="c">&lt;!-- serviceWorker.html --&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">'serviceWorker'</span> <span class="k">in</span> <span class="nx">navigator</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">navigator</span><span class="p">.</span><span class="nx">serviceWorker</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s1">'/serviceWorker.js'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">reg</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">reg</span><span class="p">.</span><span class="nx">installing</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
	    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"[*] ServiceWorker is installing..."</span><span class="p">);</span>

	    <span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="nx">reg</span><span class="p">.</span><span class="nx">installing</span><span class="p">;</span>
	    <span class="nx">worker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'statechange'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	        <span class="k">if</span> <span class="p">(</span><span class="nx">worker</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="s1">'redundant'</span><span class="p">)</span> <span class="p">{</span>
	            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[*] Install failed'</span><span class="p">);</span>
	        <span class="p">}</span>
	        <span class="k">if</span> <span class="p">(</span><span class="nx">worker</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="s1">'installed'</span><span class="p">)</span> <span class="p">{</span>
	            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[*] Install successful!'</span><span class="p">);</span>
	        <span class="p">}</span>
	    <span class="p">});</span>
	<span class="p">});</span>
<span class="p">}</span>

<span class="nt">&lt;/script&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>This will register the ServiceWorker written in the <code class="highlighter-rouge">serviceWorker.js</code> file in my root directory. The <code class="highlighter-rouge">scope</code> option defines the scope in which the ServiceWorker will be able to operate — e.g. if set to <code class="highlighter-rouge">.dir1/</code>, it will be able to intercept any requests sent from <code class="highlighter-rouge">http://site/dir1</code> and any sub-directory inside, but not from <code class="highlighter-rouge">http://site/</code> or <code class="highlighter-rouge">http://site/dir2</code>.</p>

<p>Now let’s look at the ServiceWorker itself, where we’ll choose which files to cache and define the functions that will handle the requests. The files to be cached are defined as an array of filenames that we could simply keep updating manually, but we can take advantage of some of Jekyll’s internal variables to generate that list for us.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></td><td class="code"><pre><span class="c1">// serviceWorker.js</span>
<span class="o">---</span>
<span class="nx">layout</span><span class="err">:</span> <span class="kc">null</span>
<span class="o">---</span>
<span class="nx">importScripts</span><span class="p">(</span><span class="s1">'js/vendor/serviceworker-cache-polyfill.js'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">cacheName</span> <span class="o">=</span> <span class="s1">'eduardoboucas.com-cache-v1'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">filesToCache</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// Stylesheets</span>
    <span class="s1">'/css/main.css'</span><span class="p">,</span>

    <span class="c1">// Pages and assets</span>
    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">page</span> <span class="k">in</span> <span class="nx">site</span><span class="p">.</span><span class="nx">html_pages</span> <span class="o">%</span><span class="p">}</span>
    	<span class="s1">'{{ page.url }}'</span><span class="p">,</span>
    <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
    <span class="s1">'/assets/images/glitch.png'</span><span class="p">,</span>
	<span class="s1">'/assets/images/drawing.png'</span><span class="p">,</span>
	<span class="s1">'/assets/images/bust.png'</span><span class="p">,</span>
	<span class="s1">'/assets/images/background.gif'</span><span class="p">,</span>

	<span class="c1">// Portfolio pages</span>
    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">project</span> <span class="k">in</span> <span class="nx">site</span><span class="p">.</span><span class="nx">portfolio</span> <span class="o">%</span><span class="p">}</span>
    	<span class="s1">'{{ project.url }}'</span><span class="p">,</span>
    <span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>

	<span class="c1">// Blog posts</span>
	<span class="s1">'/blog'</span><span class="p">,</span>
	<span class="s1">'/feeds/search.json'</span><span class="p">,</span>
    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">post</span> <span class="k">in</span> <span class="nx">site</span><span class="p">.</span><span class="nx">posts</span> <span class="o">%</span><span class="p">}</span>
    	<span class="s1">'{{ post.url }}'</span><span class="p">,</span>
	<span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>

    <span class="c1">// JS files, Portfolio assets and main video</span>
    <span class="c1">// (!) This will throw a Liquid error. Read below.</span>
	<span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="nx">file</span> <span class="k">in</span> <span class="nx">site</span><span class="p">.</span><span class="nx">static_files</span> <span class="o">%</span><span class="p">}</span>
        <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">extname</span> <span class="o">==</span> <span class="s1">'.js'</span> <span class="nx">or</span>
              <span class="nx">file</span><span class="p">.</span><span class="nx">path</span> <span class="nx">contains</span> <span class="s1">'/portfolio/screenshots'</span> <span class="nx">or</span>
              <span class="nx">file</span><span class="p">.</span><span class="nx">path</span> <span class="nx">contains</span> <span class="s1">'/portfolio/thumbnails'</span> <span class="o">%</span><span class="p">}</span>
              <span class="s1">'{{ file.path }}'</span><span class="p">,</span>
		<span class="p">{</span><span class="o">%</span> <span class="nx">endif</span> <span class="o">%</span><span class="p">}</span>
	<span class="p">{</span><span class="o">%</span> <span class="nx">endfor</span> <span class="o">%</span><span class="p">}</span>
<span class="p">];</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p><em>Note: The “if” tag on line 29 will throw an error as it is. I’ve separated it into multiple lines to make it more readable in the article, but unfortunately you’ll have to compress it into a single line for Liquid to accept it.</em></p>

<p>Here’s what’s happening:</p>

<ul>
  <li>Including the path to my stylesheet and to some images I need for my pages (lines 10 and 16-19);</li>
  <li>Iterating over <code class="highlighter-rouge">site.html_pages</code> and grabbing the <code class="highlighter-rouge">url</code> property of each page, which will give me the paths for all the HTML pages generated by Jekyll. This does not include posts or collections, so we’ll have to include those later (lines 13-15);</li>
  <li>Going through the <code class="highlighter-rouge">site.portfolio</code> collection to get the paths to all the individual portfolio pages (lines 22-24);</li>
  <li>Adding the actual blog posts by looping through <code class="highlighter-rouge">site.posts</code> (lines 29-31) and the JSON file used by the search plugin — if I wanted to limit the number of blog posts to cache, this would be a good place to do it;</li>
  <li>Finally, I need to add my JavaScript files and also the media assets (thumbnails and screenshots) for the Portfolio section. <code class="highlighter-rouge">site.static_files</code> is a nice place to get this, as it’s an array of files not touched by Jekyll’s templating engine. It contains absolutely everything, including the assets used in the posts which I don’t want to include, so I add a few filters to the “if” statement to say that I only want files with a <code class="highlighter-rouge">.js</code> extension <em>or</em> files located within <code class="highlighter-rouge">/portfolio/screenshots/</code> or <code class="highlighter-rouge">/portfolio/thumbnails/</code> (lines 35-41);</li>
</ul>

<p>Then we add the functions to handle the requests:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre><span class="c1">// serviceWorker.js</span>
<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'install'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">waitUntil</span><span class="p">(</span>
        <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">cacheName</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">addAll</span><span class="p">(</span><span class="nx">filesToCache</span><span class="p">);</span>
        <span class="p">})</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'fetch'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span>
        <span class="nx">caches</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[*] Serving cached: '</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[*] Fetching: '</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">);</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>The <code class="highlighter-rouge">install</code> event is fired when the ServiceWorker is triggered for the first time. I wanted to start caching files right away so this is a good place to do it. We open the cache, which returns a promise, and then start adding files to it. If any of the files fail, the entire process will abort and the ServiceWorker won’t install, so it’s important that you get all your file paths correctly.</p>

<p>The star of the show, however, is our <code class="highlighter-rouge">fetch</code> event, which gets fired whenever a request is made. When we intercept the request, we can check if the file exists in the cache — if it does, we can serve a cached version, otherwise we request it from the network.</p>

<h2 id="dealing-with-google-fonts">Dealing with Google Fonts</h2>

<p>Caching external font files from third-party providers, in my case Google Fonts, can be a bit tricky. At first, I tried to just include the URLs for the fonts on the list of files to cache (e.g. <code class="highlighter-rouge">https://fonts.googleapis.com/css?family=Lato:400,700</code>), which throws an error because it involves a redirect and that’s considered unsecure. That redirect happens because Google Fonts API does some User Agent sniffing to determine which file format to serve.</p>

<p>For example, when I open the URL above on my browser I get something like this:</p>

<figure class="highlight"><pre><code class="language-css" data-lang="css"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="k">@font-face</span> <span class="p">{</span>
  <span class="nl">font-family</span><span class="p">:</span> <span class="s2">'Lato'</span><span class="p">;</span>
  <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="m">400</span><span class="p">;</span>
  <span class="nl">src</span><span class="p">:</span> <span class="n">local</span><span class="p">(</span><span class="s2">'Lato Regular'</span><span class="p">),</span> <span class="n">local</span><span class="p">(</span><span class="s2">'Lato-Regular'</span><span class="p">),</span> <span class="sx">url(https://fonts.gstatic.com/s/lato/v11/8qcEw_nrk_5HEcCpYdJu8BTbgVql8nDJpwnrE27mub0.woff2)</span> <span class="n">format</span><span class="p">(</span><span class="s2">'woff2'</span><span class="p">);</span>
  <span class="py">unicode-range</span><span class="p">:</span> <span class="n">U</span><span class="err">+</span><span class="m">0100-024</span><span class="n">F</span><span class="p">,</span> <span class="n">U</span><span class="err">+</span><span class="m">1</span><span class="n">E00-1EFF</span><span class="p">,</span> <span class="n">U</span><span class="err">+</span><span class="m">20</span><span class="n">A0-20AB</span><span class="p">,</span> <span class="n">U</span><span class="err">+</span><span class="m">20</span><span class="n">AD-20CF</span><span class="p">,</span> <span class="n">U</span><span class="err">+</span><span class="m">2</span><span class="n">C60-2C7F</span><span class="p">,</span> <span class="n">U</span><span class="err">+</span><span class="n">A720-A7FF</span><span class="p">;</span>
<span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Because I’m running the most recent version of Chrome, it serves me a WOFF2 font file. Now, I could simply take that URL and add it to the ServiceWorker and it should work fine, because that’s a direct link and not a redirect anymore. The problem with that approach is that I would be caching a font format that not everyone can see.</p>

<p>Another option would be to download the files and store them locally, but I don’t want to start moving things from CDNs back to the server.</p>

<p>A more elegant solution is to cache the fonts at a later stage and not during the installation process. We can use the <code class="highlighter-rouge">fetch</code> event to sniff all the requests and detect when a request for a font has been made and simply cache that file — instead of going “let’s cache the WOFF2 version and hope that users support it”, we go “let’s wait to see what font files they need and cache them for future visits”.</p>

<p>Here’s how we can modify our ServiceWorker to do just that:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="nx">self</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'fetch'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">requestUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

    <span class="c1">// Is this a request for a font?</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">requestUrl</span><span class="p">.</span><span class="nx">host</span> <span class="o">==</span> <span class="s1">'fonts.gstatic.com'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">respondWith</span><span class="p">(</span>
            <span class="nx">caches</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'eduardoboucas.com-fonts'</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[*] Serving cached font: '</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

                            <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="k">return</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">cache</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">clone</span><span class="p">());</span>
                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[*] Adding font to cache: '</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>

                            <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
                        <span class="p">});</span>
                    <span class="p">});</span>
                <span class="p">})</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// It's not a font, handle the request normally</span>
        <span class="c1">// as we were doing before</span>
    <span class="p">}</span>
<span class="p">});</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="demo">Demo</h2>

<p>Here’s a demo of the thing working. It’s good because you get to see the ServiceWorker in action even if you’re not running a recent version of Chrome, but bad because I’m terrible with screencasts.</p>

<div class="post__video-wrapper" style="padding-bottom: 75.0%">
	<iframe width="420" height="315" src="https://www.youtube.com/embed/wCoUZXBlJWI" frameborder="0" allowfullscreen=""></iframe>
</div>

<p>The console errors I’ve mentioned are caused by calls to Google Analytics and there’s a really elegant way of handling this. <a href="https://googlechrome.github.io/samples/service-worker/offline-analytics/">This sample</a> shows how those calls can be stored in IndexedDB and sent to the server once a working internet connection is found. Yes, this means having analytics for offline visits, how cool is that?</p>

<h2 id="final-thoughts">Final thoughts</h2>

<p>The implementation described in this article is just my first experimentation with a ServiceWorker, but I will most likely tweak things as I go along. For example, it probably doesn’t make sense to cache all the posts, as they’ll eventually be too many. Instead, it might be better to cache a limited number of posts (the three most recent pages?) along with their assets. That’s probably a better experience for the user.</p>

<p>Unfortunately, all this is not for everyone just yet. The ServiceWorker is on Chrome, but the Cache API is yet to be natively supported. Firefox is working on its implementation as well and, as for the other browsers, we’ll have to wait and see. I would absolutely love to see this available on mobile browsers where all this stuff could be used to its full potential — that’s already possible on Mobile Chrome (Android), but who knows when (and if) it’ll land on iOS.</p>

<p>Come one, browsers. Let’s move the web forward! We’re all here waiting anxiously. &#8718;</p>

      </div>
    </article>

    
      <section class="comments">
	
	
	<hr class="comments__separator">
	<h2 class="comments__title">Comments</h2>

	
		
		
		
			
			
			
			
			

			<article id="comment1" class="comment">
	<img class="comment__avatar" src="https://www.gravatar.com/avatar/f83d04bff6b9c033a0661180788d0843?d=mm&s=180">
	<div class="comment__content-wrapper">
		<h3 class="comment__author">
			
				Suguru Hirahara
			
		</h3>
		<p class="comment__date">
			<a href="#comment1">#</a> 
			Jun 25, 2015, 3:07 pm
		</p>
		<p>Thanks for your tutorial!</p> <p>I'm just wondering if there is a way of caching files after (or at the same time) they are downloaded via browser (=transferring browser's cache to ServiceWorker). I just can't decide which files should be cached beforehand ;-)</p> <p>Thanks in advance!</p>
	</div>
</article>
		
	

	<p class="js-new-comments comments__description">Leave a comment</p>

	<form id="comments-form" class="comments__new" action="https://aws.bouc.as/jekyll-discuss/comments" method="post">
    <input type="hidden" name="post-url" value="/blog/2015/06/04/supercharging-jekyll-with-a-serviceworker.html">
    <input type="hidden" name="post-slug" value="2015-06-04-supercharging-jekyll-with-a-serviceworker">
    <input type="hidden" name="post-title" value="Supercharging Jekyll with a ServiceWorker">
    <input type="text" name="company" class="honey comments__field">
    <input class="comments__field" type="text" name="name" placeholder="Name" required/>
    <input class="comments__field" type="email" name="email" placeholder="Email address (will not be public)" required/>
    <input class="comments__field" type="url" name="url" placeholder="Website (optional)"/>
    <textarea class="comments__field" rows="10" name="message" placeholder="Comment" required></textarea>
    <span class="comments__info">You can use <a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a> in your comment.</span>
    <input id="comments-form-subscribe" type="checkbox" name="subscribe" value="subscribe">
    <label for="comments-form-subscribe">Notify me of new comments by email</label>
    <input class="comments__field" type="submit" value="Send" />
</form>
</section>

<script type="text/template" id="template--new-comment">
	<article id="comment" class="comment">
	<img class="comment__avatar" src="https://www.gravatar.com/avatar/@hash?d=mm&s=180">
	<div class="comment__content-wrapper">
		<h3 class="comment__author">
			
				@name
			
		</h3>
		<p class="comment__date">
			
			@date
		</p>
		@message
	</div>
</article>
</script>
    

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-54012006-1', 'auto');
  ga('send', 'pageview');
</script>
    <footer class="blog__footer">
	Generated by <a href="http://jekyllrb.com/">Jekyll</a>. Hosted by <a href="https://github.com/">GitHub</a>.<br/>
	<a href="http://feeds.eduardoboucas.com/eduardoboucas">
		<svg  class="blog-footer__icon--rss">
	<use xlink:href="#icn--rss"></use>
</svg>
	</a>
</footer>
</body>
</html>